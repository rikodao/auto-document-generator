<Template>
## ファイル概要

このファイルは、Amazon S3 バケットへのアップロード用の事前署名付き URL を生成する AWS Lambda 関数です。boto3 ライブラリを使用して、S3 クライアントを初期化し、指定されたバケット名とキーに基づいて事前署名付き URL を生成しています。また、この関数は環境変数から S3 バケット名を取得し、クエリ文字列パラメータからキーを取得しています。

関連するモジュール: boto3、botocore、json、logging、os

## 主要なサブルーチン

### lambda_handler(event, context)
- 引数:
  - event: AWS Lambda 呼び出しイベントオブジェクト
  - context: AWS Lambda コンテキストオブジェクト
- 戻り値: 事前署名付き URL またはエラーメッセージを含む JSON 応答
- グローバル変数の使用: logger

この関数は、次の手順を実行します:
1. S3 クライアントを初期化する
2. 環境変数から S3 バケット名を取得する
3. クエリ文字列パラメータからキーを取得する
4. オブジェクトキーを生成する
5. 事前署名付き URL の有効期限を設定する
6. s3_client.generate_presigned_url() を使用して事前署名付き URL を生成する
7. 成功した場合は、事前署名付き URL を含む JSON 応答を返す
8. エラーが発生した場合は、エラーメッセージを含む JSON 応答を返す

## データ構造

このファイルでは、特定のデータ構造は使用されていません。

## 主要なアルゴリズム

このファイルには、特徴的なアルゴリズムやロジックはありません。

## 入出力

- 入力: AWS Lambda 呼び出しイベントオブジェクト
- 出力: JSON 応答 (事前署名付き URL または エラーメッセージ)

## 利用している外部モジュールやライブラリの説明

- boto3: AWS SDK for Python。S3 クライアントを初期化し、事前署名付き URL を生成するために使用されます。
- botocore: AWS SDK for Python の低レベルライブラリ。ClientError 例外をキャッチするために使用されます。

## エラー処理の方法

ClientError 例外がキャッチされた場合、エラーメッセージを含む JSON 応答と 500 ステータスコードが返されます。

## その他の注意点

- この関数は、環境変数 UPLOAD_BUCKET から S3 バケット名を取得します。
- 生成されるオブジェクトキーは "upload/" プレフィックスが付加され、".jpg" 拡張子が付加されます。
- 事前署名付き URL の有効期限はデフォルトで 600 秒 (10 分) に設定されています。
- CORS (Cross-Origin Resource Sharing) のため、応答ヘッダーに "Access-Control-Allow-Origin": "*" が含まれています。

</Template>